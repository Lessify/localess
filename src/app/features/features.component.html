<div class="wrapper" *ngIf="settings$ | async as settings">
  <mat-toolbar color="primary">
    <button mat-icon-button (click)="onMainMenuExpendedChangeState()" matTooltip="Menu">
      <mat-icon>{{settings.mainMenuExpended ? 'menu_open' : 'menu'}}</mat-icon>
    </button>
    <span class="name">Localess</span>
    <span class="spacer"></span>

    <ng-container *ngIf="selectedSpace; else elseNoSpace">
      <button mat-flat-button [matMenuTriggerFor]="spacesMenu" matTooltip="Select a Space">
        {{selectedSpace.name}}
        <mat-icon iconPositionEnd>arrow_drop_down</mat-icon>
      </button>
      <mat-menu #spacesMenu="matMenu" yPosition="below" xPosition="after">
        <button mat-menu-item *ngFor="let space of spaces" (click)="onSpaceSelection(space)">
         <span [class.fw-semibold]="space.id === selectedSpace.id">
           {{space.name}}
         </span>
        </button>
      </mat-menu>
    </ng-container>

    <ng-template #elseNoSpace>
      <button mat-raised-button color="warn" routerLink="/features/spaces">
        No Spaces. Click here to create one.
      </button>
    </ng-template>


    <span class="spacer"></span>
    <button mat-icon-button (click)="onSettingsMenuExpendedChangeState()" matTooltip="Settings">
      <mat-icon>settings</mat-icon>
    </button>
    <button mat-icon-button  routerLink="/features/me" matTooltip="My Profile">
      <mat-icon>account_circle</mat-icon>
    </button>
    <button mat-icon-button (click)="onLogoutClick()" matTooltip="LogOut">
      <mat-icon>logout</mat-icon>
    </button>
  </mat-toolbar>

  <mat-sidenav-container autosize="true">

    <mat-sidenav mode="side" opened="true" position="start" [class.collapsed]="!settings.mainMenuExpended">
      <mat-nav-list>

        <ng-container *ngIf="selectedSpace">
          <ng-container *ngFor="let item of userSideMenu">
            <mat-list-item *ngIf="item.permission | canUserPerform | async" [routerLink]="[item.link]" routerLinkActive="active">
              <mat-icon matListItemIcon [matTooltip]="item.label">{{item.icon}}</mat-icon>
              <div matListItemTitle *ngIf="settings.mainMenuExpended">{{item.label}}</div>
            </mat-list-item>
          </ng-container>
        </ng-container>

        <ng-container *ngIf="(userPermission.USER_MANAGEMENT | canUserPerform | async ) || (userPermission.SPACE_MANAGEMENT | canUserPerform | async )">
          <mat-divider/>
          <div mat-subheader *ngIf="settings.mainMenuExpended">Admin</div>
          <ng-container *ngFor="let item of adminSideMenu">
            <mat-list-item *ngIf="item.permission | canUserPerform | async" [routerLink]="[item.link]" routerLinkActive="active">
              <mat-icon matListItemIcon [matTooltip]="item.label">{{item.icon}}</mat-icon>
              <div matListItemTitle *ngIf="settings.mainMenuExpended">{{item.label}}</div>
            </mat-list-item>
          </ng-container>
        </ng-container>

        <mat-divider/>
        <div mat-subheader *ngIf="settings.mainMenuExpended">Community and Support</div>
        <mat-list-item *ngFor="let item of communitySideMenu" (click)="openNewTab(item.link)">
          <mat-icon matListItemIcon [matTooltip]="item.label">{{item.icon}}</mat-icon>
          <div matListItemTitle *ngIf="settings.mainMenuExpended">{{item.label}}</div>
        </mat-list-item>

        <mat-divider/>
        <div mat-subheader *ngIf="settings.mainMenuExpended">Version : {{version}}</div>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav mode="over" [opened]="isSettingsMenuExpended" position="end" (openedChange)="isSettingsMenuExpended = $event">
      <mat-list>
        <div mat-subheader>Settings</div>
        <mat-list-item *ngIf="isDebug">
          <mat-slide-toggle [checked]="settings.debugEnabled" (change)="onDebugEnabledChangeState($event)">Enable Debug</mat-slide-toggle>
        </mat-list-item>
      </mat-list>
    </mat-sidenav>

    <mat-sidenav-content>
      <ng-container *ngIf="isRoleNone">
        Please contact your administrator to grant you access to resources.
      </ng-container>
      <router-outlet></router-outlet>
    </mat-sidenav-content>

  </mat-sidenav-container>
</div>
