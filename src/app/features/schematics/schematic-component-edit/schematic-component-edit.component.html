<mat-card appearance="outlined">
  <form [formGroup]="form">
    <mat-form-field>
      <mat-label>Name</mat-label>
      <input matInput type="text" formControlName="name" [readonly]="nameReadonly" autocomplete="off"/>
      <button mat-icon-button matIconSuffix (click)="nameReadonly = !nameReadonly">
        <mat-icon>{{nameReadonly ? 'edit_off' : 'edit'}}</mat-icon>
      </button>
      <mat-hint>Will be used in JSON structure.</mat-hint>
      <mat-hint align="end">{{form.value.name.length || 0}}/50</mat-hint>
      <mat-error *ngIf="form.controls['name']?.errors as errors">{{fe.errors(errors)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Kind</mat-label>
      <mat-select formControlName="kind" (selectionChange)="selectComponentKind($event)">
        <mat-select-trigger>
          <mat-icon>{{selectedComponentKind.icon}}</mat-icon>
          {{selectedComponentKind.name}}
        </mat-select-trigger>
        <mat-option *ngFor="let kind of componentKinds" [value]="kind">
          <mat-icon>{{schematicComponentKindDescriptions[kind].icon}}</mat-icon>
          {{schematicComponentKindDescriptions[kind].name}}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="form.controls['kind']?.errors as errors">{{fe.errors(errors)}}</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Display Name</mat-label>
      <input matInput type="text" formControlName="displayName" autocomplete="off"/>
      <mat-hint align="end">{{form.value.displayName?.length || 0}}/50</mat-hint>
      <mat-error *ngIf="form.controls['displayName']?.errors as errors">{{fe.errors(errors)}}</mat-error>
    </mat-form-field>

    <mat-checkbox formControlName="required">Required</mat-checkbox>
    <br/>

    <ng-container
      *ngIf="['TEXT','TEXTAREA', 'NUMBER', 'COLOR', 'DATE', 'DATETIME', 'BOOLEAN', 'OPTION', 'OPTIONS', 'LINK'].includes(form.value.kind)">
      <mat-checkbox formControlName="translatable">Translatable</mat-checkbox>
    </ng-container>

    <mat-form-field>
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" class="cdk-textarea-autosize"></textarea>
      <mat-hint align="end">{{form.value.description?.length || 0}}/250</mat-hint>
      <mat-error *ngIf="form.controls['description']?.errors as errors">{{fe.errors(errors)}}</mat-error>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Default Value</mat-label>
      <textarea matInput formControlName="defaultValue" class="cdk-textarea-autosize"></textarea>
      <mat-hint align="end">{{form.value.defaultValue?.length || 0}}/250</mat-hint>
      <mat-error *ngIf="form.controls['defaultValue']?.errors as errors">{{fe.errors(errors)}}</mat-error>
    </mat-form-field>

    <!--Number-->
    <ng-container *ngIf="form.value.kind === 'NUMBER'">
      <mat-form-field>
        <mat-label>Min Value</mat-label>
        <input matInput type="number" formControlName="minValue" autocomplete="off"/>
        <mat-error *ngIf="form.controls['minValue']?.errors as errors">{{fe.errors(errors)}}</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Max Value</mat-label>
        <input matInput type="number" formControlName="maxValue" autocomplete="off"/>
        <mat-error *ngIf="form.controls['maxValue']?.errors as errors">{{fe.errors(errors)}}</mat-error>
      </mat-form-field>
    </ng-container>

    <!--Text and Textarea-->
    <ng-container *ngIf="['TEXT','TEXTAREA'].includes(form.value.kind)">
      <mat-form-field>
        <mat-label>Min Length</mat-label>
        <input matInput type="number" formControlName="minLength" autocomplete="off"/>
        <mat-error *ngIf="form.controls['minLength']?.errors as errors">{{fe.errors(errors)}}</mat-error>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Max Length</mat-label>
        <input matInput type="number" formControlName="maxLength" autocomplete="off"/>
        <mat-error *ngIf="form.controls['maxLength']?.errors as errors">{{fe.errors(errors)}}</mat-error>
      </mat-form-field>
    </ng-container>

    <!--Option and Options-->
    <ng-container *ngIf="['OPTION', 'OPTIONS'].includes(form.value.kind)">

      <mat-card class="ll-not-shadow">
        <mat-card-header>
          <mat-card-title-group>
            <mat-card-title>
              Options
            </mat-card-title>
            <button mat-icon-button (click)="addOptionForm()">
              <mat-icon>add</mat-icon>
            </button>
          </mat-card-title-group>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content formArrayName="options">
          <ng-container *ngFor="let option of options?.controls; index as idx" [formGroupName]="idx">
            <br/>
            <mat-card [class.invalid]="option.invalid">
              <mat-card-header>
                <mat-card-title-group>
                  <mat-card-title>Option {{idx+1}}</mat-card-title>
                  <button mat-icon-button (click)="removeOptionForm(idx)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </mat-card-title-group>
              </mat-card-header>
              <mat-card-content>
                <mat-form-field>
                  <mat-label>Name</mat-label>
                  <input matInput type="text" formControlName="name" autocomplete="off"/>
                  <mat-hint align="end">{{option.value.name?.length || 0}}/30</mat-hint>
                  <mat-error *ngIf="option.controls['name']?.errors as errors">{{fe.errors(errors)}}</mat-error>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Value</mat-label>
                  <input matInput type="text" formControlName="value" autocomplete="off"/>
                  <mat-hint align="end">{{option.value.value?.length || 0}}/30</mat-hint>
                  <mat-error *ngIf="option.controls['value']?.errors as errors">{{fe.errors(errors)}}</mat-error>
                </mat-form-field>
              </mat-card-content>
            </mat-card>
          </ng-container>
        </mat-card-content>
      </mat-card>

      <ng-container *ngIf="['OPTIONS'].includes(form.value.kind)">
        <mat-form-field>
          <mat-label>Min Values</mat-label>
          <input matInput type="number" formControlName="minValues" autocomplete="off"/>
          <mat-error *ngIf="form.controls['minValues']?.errors as errors">{{fe.errors(errors)}}</mat-error>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Max Values</mat-label>
          <input matInput type="number" formControlName="maxValues" autocomplete="off"/>
          <mat-error *ngIf="form.controls['maxValues']?.errors as errors">{{fe.errors(errors)}}</mat-error>
        </mat-form-field>
      </ng-container>

    </ng-container>

    <!--SCHEMATIC-->
    <ng-container *ngIf="form.value.kind === 'SCHEMATIC'">
      <mat-form-field>
        <mat-label>Schematic</mat-label>
        <mat-select formControlName="schematics" multiple>
          <mat-option *ngFor="let schematic of schematics" [value]="schematic.id">
            {{schematic.name}}
            <span *ngIf="schematic.displayName"> ({{schematic.displayName}})</span>
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.controls['schematic']?.errors as errors">{{fe.errors(errors)}}</mat-error>
      </mat-form-field>
    </ng-container>

  </form>
</mat-card>

<ng-container *ngIf="isTest">
  <pre>{{form.value | json}}</pre>
</ng-container>
